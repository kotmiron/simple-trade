{% extends 'SimpleTradeBundle::layout.html.twig' %}

{% block body %}

<table>
    <tr>
        <td>
                <h1>Заявление на регистрацию пользователя</h1>
                <form action="" method="post" {{ form_enctype(form) }} class="form-horizontal" id="registerCompany">
                      {{ form_errors(form) }}

                      <fieldset>
                        <legend>Основные сведения</legend>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.role) }}</div>
                            <div class="controls">
                                {{ form_widget(form.role) }}
                                <span class="help-inline">{{ form_errors(form.role) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.sro) }}</div>
                            <div class="controls">
                                <select id="sro" class="validate[required]" required="required">
                                    {% for key, sro in sros %}
                                        <option value="" disabled>{{ key }}</option>
                                        {% for id, item in sro %}
                                            <option value="{{ id }}" type="{{ item['type'] }}">&nbsp&nbsp&nbsp&nbsp{{ item['title'] }}</option>
                                        {% endfor %}
                                    {% endfor %}
                                </select>
                                <span class="help-inline">{{ form_errors(form.sro) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label"><a href="" id="show_skills"><span>Квалификации</span> <i class="icon-plus-sign"></i></a></div>

                            <div id="skills" style="display:none">
                                <table class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th>Название</th>
                                        <th>Квалификация</th>
                                        <th>Основная</th>
                                        <th><nobr>Опасные объекты</nobr></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for parent_id, parent in skills %}
                                        <tr type="{{ parent['type'] }}" class="skills_type" style="display:none">
                                            <td colspan="4">
                                              <label><input type="checkbox" id="cat_parent{{ parent_id }}" parent="" value="/" class="validate[required]" name="group1">{{ parent['title'] }}</label>
                                            </td>
                                        </tr>
                                        {% for id, skill in parent['skills'] %}
                                            <tr type="{{ parent['type'] }}" class="skills_type" style="display:none">
                                                <td></td>
                                                <td>
                                                    <label><input type="checkbox" id="cat_child{{ id }}" parent="cat_parent{{ parent_id }}" value="/" class="validate[required]" name="group1">{{ skill }}</label>
                                                </td>
                                                <td class="c">
                                                    <input type="checkbox" class="attribute" obj="main" parent="{{ id }}">
                                                </td>
                                                <td class="c">
                                                    <input type="checkbox" class="attribute" obj="dangerous" parent="{{ id }}">
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {{ form_widget(form.skills) }}

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.region) }}</div>
                            <div class="controls">
                                {{ form_widget(form.region) }}
                                <span class="help-inline">{{ form_errors(form.region) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.name) }}</div>
                            <div class="controls">
                                {{ form_widget(form.name) }}
                                <span class="help-inline">{{ form_errors(form.name) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.title) }}</div>
                            <div class="controls">
                                {{ form_widget(form.title) }}
                                <span class="help-inline">{{ form_errors(form.title) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.email) }}</div>
                            <div class="controls">
                                {{ form_widget(form.email) }}
                                <span class="help-inline">{{ form_errors(form.email) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.login) }}</div>
                            <div class="controls">
                                {{ form_widget(form.login) }}
                                <span class="help-inline">{{ form_errors(form.login) }}</span>
                            </div>
                        </div>


                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.password) }}
                                <span class="help-inline">{{ form_errors(form.password) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.inn) }}</div>
                            <div class="controls">
                                {{ form_widget(form.inn) }}
                                <span class="help-inline">{{ form_errors(form.inn) }}</span>
                            </div>
                        </div>


                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.kpp) }}</div>
                            <div class="controls">
                                {{ form_widget(form.kpp) }}
                                <span class="help-inline">{{ form_errors(form.kpp) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.ogrn) }}</div>
                            <div class="controls">
                                {{ form_widget(form.ogrn) }}
                                <span class="help-inline">{{ form_errors(form.ogrn) }}</span>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Сведения о лице, подписавшем Заявку</legend>
                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.lastname) }}</div>
                            <div class="controls">
                                {{ form_widget(form.lastname) }}
                                <span class="help-inline">{{ form_errors(form.lastname) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.firstname) }}</div>
                            <div class="controls">
                                {{ form_widget(form.firstname) }}
                                <span class="help-inline">{{ form_errors(form.firstname) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.patronymic) }}</div>
                            <div class="controls">
                                {{ form_widget(form.patronymic) }}
                                <span class="help-inline">{{ form_errors(form.patronymic) }}</span>
                            </div>
                        </div>


                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.position) }}</div>
                            <div class="controls">
                                {{ form_widget(form.position) }}
                                <span class="help-inline">{{ form_errors(form.position) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.grounds) }}</div>
                            <div class="controls">
                                {{ form_widget(form.grounds) }}
                                <span class="help-inline">{{ form_errors(form.grounds) }}</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-label">{{ form_label(form.phone) }}</div>
                            <div class="controls">
                                {{ form_widget(form.phone) }}
                                <span class="help-inline">{{ form_errors(form.phone) }}</span>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Документы</legend>
                        <div class="control-group">
                          <ul class="files" data-prototype="{{ form_widget(form.files.vars.prototype)|e }}">
                              {% for file in form.files %}
                                  <li>{{ form_row(file.file) }}</li>
                              {% endfor %}
                          </ul>
                        </div>
                    </fieldset>

                    {{ form_rest(form) }}

                    <div class="control-group">
                        <div class="controls">
                            <input type="submit" value="Ok" class="but" id="submit"/>
                        </div>
                    </div>
                </form>
        </td>
        <td class="main-sidebar">
            {% render "SimpleTradeBundle:Security:login" %}
        </td>
    </tr>
</table>

<script type="text/javascript">
    $(document).ready(function()
    {
        formObject.initForm("registerCompany");

        {% for parent in skills %}
            {% for id, skill in parent['skills'] %}
                skills[{{ id }}] = new Array();
                skills[{{ id }}]["main"] = 0;
                skills[{{ id }}]["dangerous"] = 0;
            {% endfor %}
        {% endfor %}
        defaultSkills = skills;

        $('#registerCompany_role').change(function()
        {
            var role = $('#registerCompany_role option:selected').val();
            if (role == 'CUSTOMER')
            {
                $('#sro').closest('.control-group').hide();
                $('#show_skills').hide();
                $('#skills').hide();
            }
            else
            {
                $('#sro').closest('.control-group').show();
                $('#show_skills').show();
            }
            return false;
        });

        $('#sro').change(function()
        {
            $('#registerCompany_sro').val($(this).val());
            $('tr.skills_type').hide();
            $('tr.skills_type[type="' + $('#sro option:selected').attr('type') + '"]').show();
            $('input[type="checkbox"]').removeAttr('checked');
            skills = defaultSkills;
        });

        $('#registerCompany_sro').val($('#sro').val());
        $('tr.skills_type[type="' + $('#sro option:selected').attr('type') + '"]').show();
    });
</script>
{% endblock %}

